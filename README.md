# Training End-to-end Steering Models with Unfiltered Driving Data

This repository contains the necessary code for training and testing a simple end-to-end steering model with unfiltered data from the A2D2 dataset.

The contents of this repository should be referenced and used with caution as the study done with this code yielded poor results for end-to-end steering performance. 

## Contents

### Folders

- **data**: Folder for placing the data used for training and testing.
- **models**: Folder for storing model architectures. Currently only contains a Pytorch implementation of the Nvidia developed PilotNet.
- **outputs**: Default path for storing outputs generated by the training and testing scripts.
- **weights**: Default path for storing weights.

### Files

- **dataloader.py**: Custom Pytorch dataloader for the A2D2 dataset with RGB images as samples and steering angles as labels.
- **generate_samples.py**: Script for visualising samples from the dataset. Usage described in detail in the usage: testing section.
- **README.md**: This README file.
- **requirements.txt**: Requirements file for quick pip installation of the required python libraries.
- **test.py**: Script for testing the trained model. Usage described in detail in the usage: testing section.
- **train.py**: Script for training the model. Usage described in detail in the usage: training section.
- **udacity_dataloader.py**: Custom dataloader for the Udacity challenge 2 dataset for possible future use.

## Usage

Quick starting guide for training and testing models using these scripts.

### Requirements

Install the required Python libraries.

```pip3 install -r requirements.txt```

Download [the A2D2 driving data](https://www.a2d2.audi/a2d2/en/download.html). For quick usage with the default arguments download the front center camera and bus signals from Gaimersheim and extract the tar files to the data folder. The default paths correspond to the file stucture of these tar files. 

### Training

Run the script train.py. By default the training is done with 80/20 training and validation split. The training also uses the iterative trimmed loss minimization and data augmentations which can be left out with the arguments ```--no_itlm``` and  ```--no_augs```. The default alpha value for the iterative trimmed loss minimization is 5%, which can be changed with the argument ```--alpha=0.05```.

```python3 train.py --model=PilotNet --no_itlm --no_augs --alpha=0.05```

The training scripts generates three output files when it completes: 

- weights: By default saved to the weights folder.
- errors.csv: A CSV file containing training and validation errors for each training batch. By default saved to the outputs folder.
- errors.png: A quick plot showing the evolution of the training and validation errors during training. By default saved to the outputs folder and regenerated every batch based on a moving average of the last 20 batches. 

The default naming format for the output files is this: ```[modelname]_[itlm/no_itlm]_[augs/no_augs]_[alpha*100].[file_format]```

To save the the terminal output of the training scripts use ```tee``` as such:

```python3 -u train.py --model=PilotNet --no_itlm --no_augs --alpha=0.05 | tee outputs/training_output.txt```

### Testing

The testing script calculates mean absolute error over the validation set and outputs it in the terminal.

```python3 test.py --model=PilotNet```

The sample generation script generates an image consisting of rows of three images with their corresponding predicted and true labels as titles.

```python3 generate_samples.py --model=PilotNet```
